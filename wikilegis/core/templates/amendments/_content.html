{% load wikilegis_utils i18n %}

<div class="amendments__content--{{amendment_type}}"
    data-segment-id="{{segment.id}}"
    data-object-type="{{amendment_type}}"
    data-segment-content="{{segment.content|safe}}"
    data-tab-container >
  <p class="content__text" >
    {% block segment_type %}{% endblock segment_type %}
    <span data-diff-wrapper>
      {{segment.content|safe}}
    </span>
  </p>
  {% if amendment_type == 'additive' %}
    <p class="content__text" data-additive-preview>
    </p>
  {% endif %}

  <ol class="content__amendments" data-amendments-wrapper>
    {% for amendment in amendments %}
      {% include "amendments/_item.html" with amendment_type=amendment_type amendment=amendment %}
    {% endfor %}
  </ol>

  {% if request.user.is_authenticated and segment.bill.status != 'closed' %}
    <form class="amendments__form" action="/test" data-amendments-form>
    {% if amendment_type == 'additive' %}
      {% get_segment_types as segment_types %}
      <select name="segment_type" id="segment_type" required data-{{amendment_type}}-amendment-select>
        <option value="{{segment.segment_type.id}}">{{segment.segment_type.presentation_name}}</option>
        {% for segment_type in segment_types %}
          <option value="{{segment_type.id}}">{{segment_type.presentation_name}}</option>
        {% endfor %}
      </select>
    {% endif %}
    <input class="form__input" name="content"
      type="text"
      placeholder="{% trans 'Type your amendment' %}"
      data-{{amendment_type}}-amendment-input />
    <button class="form__btn">{% trans 'Send' %}</button>
  </form>
  {% elif segment.bill.status == 'closed' %}
    <div class="amendments__form">
      <p>{% trans "This project is closed for participations." %}</p>
    </div>
  {% else %}
    <div class="amendments__form">
      <p>{% blocktrans %}You must be logged to comment.{% endblocktrans %}</p>
    </div>
  {% endif %}
</div>
